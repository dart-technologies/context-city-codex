# Codex Remotion Pipeline

Prototype Remotion project that renders ContextCity Codex highlight narratives into MP4 reels. The default composition applies ContextCity's dark glassmorphism aesthetic (navy base, warm accent inspired by Dartagnan's bandana) with buttery fades between segments. It mirrors the Creatomate payload shape so we can swap rendering engines while keeping the same narrative JSON.

## Getting started

```bash
cd services/remotion-pipeline
npm install
```

Preview the composition with mock data:

```bash
npm run preview
```

Render a demo reel:

```bash
npm run render
```

Render with a custom props file generated by the workers CLI:

```bash
npm run render:props -- --props /tmp/felix-remotion.json
```

## Supplying custom data

The renderer expects a JSON payload shaped like `examples/sample-narrative.json`. To render with your own narrative:

```bash
npx remotion render src/index.tsx CodexHighlightVideo out/custom-run.mp4 --props ./path/to/narrative.json
```

Generate the props file directly from the workers CLI:

```bash
poetry run content-workers demo \
  --input fixtures/sample_assets.json \
  --frame-sample-size 2 \
  --remotion-props-output /tmp/codex-remotion.json
```

Then point Remotion at the saved JSON:

```bash
npx remotion render src/index.tsx CodexHighlightVideo out/custom-run.mp4 --props /tmp/codex-remotion.json
```

The props file includes per-locale subtitles and optional narration audio URLs. Adjust `--voiceover-locales` or `--voiceover-audio-prefix` in the CLI call if you want to target different languages or asset buckets. We bundled example props and audio for Felix (`examples/felix-{fr,en,es}.json` plus `public/audio/poi-felix-*.wav`) so the Expo mock can swap localized reels instantly.

## TODO

- Wire soundtrack assets and dynamic transitions once the audio plan lands.
- Align clip duration and transitions with production timing cues.

Example: save your Felix interior shot as `public/assets/felix-rooftop.jpg` and the Liberty fan fest skyline as `public/assets/liberty-fan-fest.jpg` before running the workers CLI with `--remotion-media-dir services/remotion-pipeline/assets`.
